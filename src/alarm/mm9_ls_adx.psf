var
  mme, mme1, mme2 : float;
  adxVal          : float;
  min1, max1      : float;

begin
  // -------- Pr√©-c√°lculos (fora de condicionais) --------
  mme    := MediaExp(9, Close);       // per√≠odo fixo: 9
  mme1   := MediaExp(9, Close)[1];
  mme2   := MediaExp(9, Close)[2];
  adxVal := ADX(14,7);               // ADX um pouco mais r√°pido 14,7
  min1   := Minima[1];
  max1   := Maxima[1];

  // -------- Regras --------
  if IsBought then
  begin
    // Stop de compra: perdeu a m√≠nima anterior
    if Close <= min1 then
    begin
      Alert(clYellow);
      PlotText("‚ö† Stop: abaixo da m√≠nima anterior", clYellow, 3, 6, High);
      //SellToCoverStop(Close, Close);
      //SellToCoverAtMarket;
    end;
  end
  else if IsSold then
  begin
    // Stop de short: rompeu a m√°xima anterior
    if Close >= max1 then
    begin
      Alert(clYellow);
      PlotText("‚ö† Stop: acima da m√°xima anterior", clYellow, 3, 6, Low);
      //BuyToCoverStop(Close, Close);
      //BuyToCoverAtMarket;
    end;
  end
  else
  begin
    // Entradas s√≥ com for√ßa (ADX >= 25)
    if adxVal >= 25 then
    begin
      // Revers√£o de ALTA na MME -> poss√≠vel COMPRA
      if (mme > mme1) and (mme1 < mme2) then
      begin
        //Alert(clGreen);
        PlotText("‚úÖ Revers√£o MME com ADX forte ‚Äî poss√≠vel compra", clGreen, 3, 6, Low);
      end;

      // Revers√£o de BAIXA na MME -> poss√≠vel SHORT
      if (mme < mme1) and (mme1 > mme2) then
      begin
        //Alert(clRed);
        PlotText("üö® Revers√£o MME com ADX forte ‚Äî poss√≠vel venda (short)", clRed, 3, 6, High);
      end;
    end;
  end;
end;


