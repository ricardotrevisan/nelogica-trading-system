var
  preco : float;
  stop  : float;

begin
  // ======================
  // ðŸ“ˆ Quando comprado
  // ======================
  if IsBought then
  begin
    if Close <= Minima[1] then
    begin
      Alert(clYellow);
      PlotText("âš  Stop: abaixo da mÃ­nima anterior", clYellow, 3, 6, High);
      //SellToCoverStop(Close, Close);
      //SellToCoverAtMarket;
    end;
  end

  // ======================
  // ðŸ“‰ Quando vendido
  // ======================
  else if IsSold then
  begin
    if Close >= Maxima[1] then
    begin
      Alert(clYellow);
      PlotText("âš  Stop: acima da mÃ¡xima anterior", clYellow, 3, 6, Low);
      //BuyToCoverStop(Close, Close);
      //BuyToCoverAtMarket;
    end;
  end

  // ======================
  // âš™ï¸ Sem posiÃ§Ã£o
  // ======================
  else
  begin
    // ReversÃ£o de alta (compra)
    if (MediaExp(9, Close) > MediaExp(9, Close)[1]) and
       (MediaExp(9, Close)[1] < MediaExp(9, Close)[2]) then
    begin
      //Alert(clGreen);
      PlotText("âœ… ReversÃ£o MME9 â€” possÃ­vel compra", clGreen, 3, 6, Low);
    end;

    // ReversÃ£o de baixa (short)
    if (MediaExp(9, Close) < MediaExp(9, Close)[1]) and
       (MediaExp(9, Close)[1] > MediaExp(9, Close)[2]) then
    begin
      //Alert(clRed);
      PlotText("ðŸš¨ ReversÃ£o MME9 â€” possÃ­vel venda (short)", clRed, 3, 6, High);
    end;
  end;
end;
